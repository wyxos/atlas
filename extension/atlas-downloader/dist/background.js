(function(){"use strict";const c=["atlasBaseUrl","atlasToken"];chrome.runtime.onMessage.addListener((t,s,n)=>!t||t.type!=="atlas-download"&&t.type!=="atlas-download-batch"&&t.type!=="atlas-check-batch"&&t.type!=="atlas-react"?void 0:((t.type==="atlas-download-batch"?k(t.payloads):t.type==="atlas-check-batch"?y(t.urls):t.type==="atlas-react"?p(t.payload):d(t.payload)).then(e=>n(e)).catch(e=>{n({ok:!1,error:e&&e.message?e.message:"Unexpected error"})}),!0));async function d(t){const s=await chrome.storage.sync.get(c);return h(t,s)}async function p(t){const s=await chrome.storage.sync.get(c);return g(t,s)}async function y(t){const s=await chrome.storage.sync.get(c),n=u(s.atlasBaseUrl||""),o=(s.atlasToken||"").trim();if(!n)return{ok:!1,error:"Atlas base URL is not set. Open extension options to configure it."};const e=Array.isArray(t)?t.filter(r=>typeof r=="string"&&r.trim()!==""):[];if(e.length===0)return{ok:!0,data:{results:[]}};const a=[];for(let r=0;r<e.length;r+=200){const w=e.slice(r,r+200),l=await fetch(`${n}/api/extension/files/check`,{method:"POST",headers:{"Content-Type":"application/json",...o?{"X-Atlas-Extension-Token":o}:{}},body:JSON.stringify({urls:w})}),i=await f(l);if(!l.ok)return{ok:!1,error:i&&i.message?i.message:`Request failed (${l.status}).`,status:l.status,data:i};Array.isArray(i?.results)&&a.push(...i.results)}return{ok:!0,data:{results:a}}}async function k(t){const s=await chrome.storage.sync.get(c),n=Array.isArray(t)?t:[];if(n.length===0)return{ok:!0,results:[]};const o=[];for(const a of n)o.push(await h(a,s));const e=o.every(a=>a&&a.ok);return{ok:e,results:o,...e?{}:{error:"One or more requests failed."}}}async function h(t,s){const n=u(s.atlasBaseUrl||""),o=(s.atlasToken||"").trim();if(!n)return{ok:!1,error:"Atlas base URL is not set. Open extension options to configure it."};const e=await fetch(`${n}/api/extension/files`,{method:"POST",headers:{"Content-Type":"application/json",...o?{"X-Atlas-Extension-Token":o}:{}},body:JSON.stringify(t)}),a=await f(e);return e.ok?{ok:!0,data:a}:{ok:!1,error:a&&a.message?a.message:`Request failed (${e.status}).`,status:e.status,data:a}}async function g(t,s){const n=u(s.atlasBaseUrl||""),o=(s.atlasToken||"").trim();if(!n)return{ok:!1,error:"Atlas base URL is not set. Open extension options to configure it."};const e=await fetch(`${n}/api/extension/files/react`,{method:"POST",headers:{"Content-Type":"application/json",...o?{"X-Atlas-Extension-Token":o}:{}},body:JSON.stringify(t)}),a=await f(e);return e.ok?{ok:!0,data:a}:{ok:!1,error:a&&a.message?a.message:`Request failed (${e.status}).`,status:e.status,data:a}}function u(t){const s=t.trim();return s?(/^https?:\/\//i.test(s)?s:`https://${s}`).replace(/\/+$/,""):""}async function f(t){try{return await t.json()}catch{return null}}})();
