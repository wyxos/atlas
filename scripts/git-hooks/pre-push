#!/usr/bin/env bash
set -euo pipefail

# Run from repo root
cd "$(git rev-parse --show-toplevel)"

# Try to find herd or php in PATH
if command -v herd &> /dev/null; then
    PHP_CMD="herd php"
elif command -v php &> /dev/null; then
    PHP_CMD="php"
else
    echo "Error: Neither 'herd' nor 'php' found in PATH"
    exit 1
fi

echo "Running pre-push checks..."

echo "1/3 Generating Laravel action classes..."
$PHP_CMD artisan wayfinder:generate

echo "2/3 Running npm tests..."
npm run test

echo "3/3 Running PHP tests..."
$PHP_CMD artisan test

echo "All pre-push checks passed!"
exit 0

